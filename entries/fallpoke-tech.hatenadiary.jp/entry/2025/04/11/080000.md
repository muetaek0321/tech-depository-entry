---
Title: Streamlitã§ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¨ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ç”»é¢ã‚’ä½œã‚‹
Category:
- Python
- Webã‚¢ãƒ—ãƒª
- å‚™å¿˜éŒ²
Date: 2025-04-11T08:00:00+09:00
URL: https://fallpoke-tech.hatenadiary.jp/entry/2025/04/11/080000
EditURL: https://blog.hatena.ne.jp/fallpoke/fallpoke-tech.hatenadiary.jp/atom/entry/6802418398343486621
---

ãŠç–²ã‚Œæ§˜ã§ã™ã€‚  

Pythonã®Webã‚¢ãƒ—ãƒªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚‹Streamlitã‚’ä½¿ã£ã¦ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¨ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ç”»é¢ã‚’ä½œã£ã¦ã¿ãŸã®ã§ãã®ç´¹ä»‹ã€‚  
ä»¥å‰ä½œæˆã—ã¦ã„ãŸãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®ã‚¢ãƒ—ãƒªã«å®Ÿè£…ã—ã¦ã„ãŸã‚‚ã®ã‚’ãƒ‡ãƒ¢ç”¨ã«æ©Ÿèƒ½ã ã‘ã‚’å–ã‚Šå‡ºã—ãŸæ„Ÿã˜ã§ã™ã€‚â†“  

[https://github.com/muetaek0321/streamlit-chatbot:embed:cite]

ä»Šå›ä½œæˆã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚

[https://github.com/muetaek0321/tech-depository/tree/main/post_20250411:embed:cite]

<hr>

ä½¿ç”¨ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Streamlitã¨**Streamlit-Authenticator**ã§ã™ã€‚  
Streamlit-Authenticatorã«ãƒ¦ãƒ¼ã‚¶èªè¨¼ã«å¿…è¦ãªæ©Ÿèƒ½ãŒãã‚ã£ã¦ã„ã¾ã™ã€‚å…¬å¼ã®GitHubãŒä»¥ä¸‹â†“
[https://github.com/mkhorasani/Streamlit-Authenticator:embed:cite]

- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
> pip install streamlit  
> pip install streamlit-authenticator  

ãã‚Œãã‚Œã®ç”»é¢ã®æ©Ÿèƒ½ã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦è»½ãèª¬æ˜ã—ã¾ã™ã€‚

### ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼‰

- main.py  
æœ€åˆã«é–‹ããƒšãƒ¼ã‚¸ã«ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹UIãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚  
[f:id:fallpoke:20250410233638p:plain]

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æœ€åˆã«èªè¨¼ç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’æº–å‚™ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¹ã¯st.session_stateã«æ ¼ç´ã—ã¦ã»ã‹ã®ãƒšãƒ¼ã‚¸ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  
auth.yamlã¯ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç­‰ã®æƒ…å ±ã‚’è¨˜è¼‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚Šã¾ã™ã€‚ï¼ˆä»Šå›ã¯ä½œæˆã—ã¦ã„ã¾ã›ã‚“ãŒã€å­˜åœ¨ã—ãªã„ã¨ãã«åˆæœŸåŒ–ã§ä½œæˆã™ã‚‹ã‚ˆã†ãªå‡¦ç†ã‚’ã¤ãã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ï¼‰
```python
# å®šæ•°
AUTH_FILE_PATH = Path("auth.yaml")

with open(AUTH_FILE_PATH, mode="r") as f:
    auth = yaml.safe_load(f)

st.session_state.auth_controller = AuthenticationController(auth['credentials'])
```

Streamlit-Authenticatorã§ã¯ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è‡ªä½“ã‚’ç°¡å˜ã«ä½œæˆã™ã‚‹æ©Ÿèƒ½ã‚’å‚™ãˆã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒã—ã«ãã„ã®ã§è‡ªä½œã—ã¦ã„ã¾ã™ã€‚Streamlitã®st.markdownã‚„st.text_inputã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
```python
st.title("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãƒ‡ãƒ¢")

st.write("ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã—ã¦ã¿ã‚‹ï¼")
with st.container(border=True):
    st.markdown(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼š")
    username = st.text_input(" ", label_visibility="collapsed", key="username_login")
    st.markdown(f"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š")
    password = st.text_input(" ", type='password', label_visibility="collapsed", key="password_login")

    # ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³
    login_button(username, password)

st.divider()

col1, col2 = st.columns([2, 1])
with col1:
    st.write("ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ã™ã‚‹ï¼")
with col2:
    if st.button("æ–°è¦ç™»éŒ²", use_container_width=True):
        st.switch_page("./pages/signup.py")
```

st.text_inputã«å…¥åŠ›ã•ã‚ŒãŸå†…å®¹ã‚’å–å¾—ã—ã¦ã€Streamlit-Authenticatorã®æ©Ÿèƒ½ã®ã¿ã§èªè¨¼ã™ã‚‹ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½ãŒãã‚Œã«ã‚ãŸã‚Šã¾ã™ã€‚  
**st.session_state.auth_controller.login(username, password)**ã®éƒ¨åˆ†ã§å…¥åŠ›ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦True/Falseã‚’è¿”ã—ã¦ãã‚Œã‚‹æ„Ÿã˜ã§ã™ã€‚
```python
def login_button(username: str, password: str) -> None:
    """ãƒ­ã‚°ã‚¤ãƒ³ã®ãƒœã‚¿ãƒ³
    """
    if st.button("ãƒ­ã‚°ã‚¤ãƒ³", use_container_width=True, type='primary'):
        auth_ok = st.session_state.auth_controller.login(username, password)
        # ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
        if auth_ok:
            st.switch_page("./pages/page.py")
        # ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—
        else:
            st.error("ãƒ¦ãƒ¼ã‚¶åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚", icon="ğŸš¨")
```

### ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ç”»é¢
- pages/signup.py  
ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‹ã‚‰é·ç§»ã§ãã‚‹ã‚ˆã†ãªä½œã‚Šã«ãªã£ã¦ã„ã¾ã™ã€‚
[f:id:fallpoke:20250410235108p:plain]

åŸºæœ¬çš„ã«ã¯å…¥åŠ›ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’auth.yamlã«åˆã‚ã›ãŸå½¢ã«æˆå½¢ã—ã¦æ›¸ãè¾¼ã‚€ã ã‘ã®å‡¦ç†ã§ã™ã€‚ãŸã ã—ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«é–¢ã—ã¦ã¯å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’**Hasher.hash(password)**ã§ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆå…ƒã®æ–‡å­—åˆ—ã‚’ä¸è¦å‰‡ãªæ–‡å­—åˆ—ã«ç½®æ›ã™ã‚‹å‡¦ç†ï¼‰ã—ã¦æ›¸ãè¾¼ã‚€å½¢ã«ãªã‚Šã¾ã™ã€‚  
ã¾ãŸã€UIã«ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…¥åŠ›æ¬„ãŒã‚ã‚‹ã‚ˆã†ã«ã€ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»¥å¤–ã®æƒ…å ±ã‚’ä»˜åŠ ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ã—ãŸã¨ãã«ä¸€ç·’ã«æƒ…å ±ã¨ã—ã¦å–å¾—ã§ãã¾ã™ã€‚
```python
st.title("æ–°è¦ãƒ¦ãƒ¼ã‚¶ç™»éŒ²")

st.write("ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")

with st.container(border=True):
    st.markdown(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼å{REQUIRED_MARK}ï¼š", unsafe_allow_html=True)
    username = st.text_input(" ", label_visibility="collapsed", key="username_signup")
    st.markdown(f"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰{REQUIRED_MARK}ï¼š", unsafe_allow_html=True)
    password = st.text_input(" ", type='password', label_visibility="collapsed", key="password_signup")
    st.markdown(f"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼š", unsafe_allow_html=True)
    email = st.text_input(" ", label_visibility="collapsed", key="email")

    col1, col2 = st.columns(2)
    with col1:
        if st.button("ç™»éŒ²", use_container_width=True):
            # èªè¨¼ãƒ‡ãƒ¼ã‚¿ãŒæ›¸ãè¾¼ã¾ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
            with open(AUTH_FILE_PATH, mode="r") as f:
                yaml_data = yaml.safe_load(f)
                
                # ãƒ¦ãƒ¼ã‚¶ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆã®å¯¾å‡¦
                if yaml_data["credentials"]["usernames"] is None:
                    yaml_data["credentials"]["usernames"] = dict()
            
            if (username == "") or (password == ""):
                # ãƒ¦ãƒ¼ã‚¶åorãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›æ¬„ãŒç©ºæ¬„ã®å ´åˆ
                st.error("ãƒ¦ãƒ¼ã‚¶åãŠã‚ˆã³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ã¯å¿…é ˆã§ã™ã€‚", icon="ğŸš¨")
            elif username in yaml_data["credentials"]["usernames"].keys():
                # æ—¢ã«ç™»éŒ²æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶åã®å ´åˆ
                st.error("ç™»éŒ²æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶åã¨é‡è¤‡ã—ã¦ã„ã¾ã™ã€‚<br>åˆ¥ã®ãƒ¦ãƒ¼ã‚¶åã§ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚", icon="ğŸš¨")
            else:
                # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–
                password_hashed = Hasher.hash(password)
                
                # èªè¨¼ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
                yaml_data["credentials"]["usernames"][username] = {
                    "name": username,
                    "password": password_hashed,
                    "email": email
                }
                with open(AUTH_FILE_PATH, "w") as f:
                    yaml.dump(yaml_data, f)
                    
                # ãƒˆãƒƒãƒ—ç”»é¢ã«æˆ»ã‚‹
                complate_signup_alert()

    with col2:
        if st.button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«", use_container_width=True):
            # ç™»éŒ²ã›ãšã«ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
            st.switch_page("./main.py")
```

#### ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ç”»é¢
- pages/page.py  
ã€Œãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã€ãŒã‚ã‚‹ã®ã§å°‘ã—ã ã‘ç´¹ä»‹ã€‚ã¨ã„ã£ã¦ã‚‚**st.session_state.auth_controller.logout()**ã‚’ä½¿ç”¨ã™ã‚‹ã ã‘ã§ã™ã­ã€‚

```python
@st.dialog("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ")
def logout_dialog() -> None:
    """ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    """
    st.write("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ")
    col1, col2 = st.columns(2)
    with col1:
        if st.button("OK", use_container_width=True):
            st.session_state.auth_controller.logout()
            st.switch_page("./main.py")
    with col2:
        if st.button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«", use_container_width=True):
            st.rerun()

```

##### ã‚ã¨ãŒã
ä»Šå›ã¯Streamlit-Authenticatorã‚’ä½¿ã£ã¦ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¨ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ç”»é¢ã‚’ã–ã£ãã‚Šä½œã£ã¦ã¿ã¾ã—ãŸã€‚ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ã§ã—ãŸãŒCookieã‚’åˆ©ç”¨ã—ãŸå‡¦ç†ãªã©ã‚‚ã‚ã‚‹ã‚ˆã†ãªã®ã§ã¾ã ã¾ã ã‚„ã‚Œã‚‹ã“ã¨ã¯å¤šãã†ã§ã™ã€‚  
Streamlitã‚‚Pythonã®ã¿ã§ã‹ãªã‚Šè‰¯ã„æ„Ÿã˜ã«Webã‚¢ãƒ—ãƒªã‚’ä½œæˆã§ãã¾ã™ã—ã€é–¢é€£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚å¢—ãˆã¦ããŸã®ã§ã‹ãªã‚Šä½¿ã„ã‚„ã™ããªã£ã¦ã„ã‚‹å°è±¡ã§ã™ï¼
